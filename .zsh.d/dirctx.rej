***************
*** 43,62 ****
  
      __status=`ls .svn 2>/dev/null 1>/dev/null; echo $?`
      if [ "$__status" = "0" ]; then
-         echo -n 'subversion'
-         case "$PWD" in
              *trunk*)
-                 echo -n ': trunk'
              ;;
              *branches*)
-                 echo -n ': branches'
-                 branch=`echo -n $PWD | sed -e 's/.*branches\///' | sed -e 's/\/.*//'`
-                 test $branch && echo -n "/$branch"
              ;;
              *tags*)
-                 echo -n ': tags'
-                 tag=`echo -n $PWD | sed -e 's/.*tags\///' | sed -e 's/\/.*//'`
-                 test $tag && echo -n "/$tag"
              ;;
          esac
          return
--- 43,65 ----
  
      __status=`ls .svn 2>/dev/null 1>/dev/null; echo $?`
      if [ "$__status" = "0" ]; then
+         echo -n 'svn'
+         __svn_status=(`LANG=C svn info|awk '/^URL:/{url = $2} /^Last Changed Rev:/{rev = $4; print url " " rev} '`)
+         url=`echo ${__svn_status[1]}`
+         revision=`echo ${__svn_status[2]}`
+         case "$url" in
              *trunk*)
+                 echo -n ":trunk:$revision"
              ;;
              *branches*)
+                 echo -n ':branches'
+                 branch=`echo -n $url | sed -e 's/.*branches\///' | sed -e 's/\/.*//'`
+                 test $branch && echo -n "/$branch:$revision"
              ;;
              *tags*)
+                 echo -n ':tags'
+                 tag=`echo -n $url | sed -e 's/.*tags\///' | sed -e 's/\/.*//'`
+                 test $tag && echo -n "/$tag:$revision"
              ;;
          esac
          return
***************
*** 81,84 ****
  
  DIRCTX=`dirctx $PWD`
  
- export DIRCTX--- 84,87 ----
  
  DIRCTX=`dirctx $PWD`
  
+ export DIRCTX
